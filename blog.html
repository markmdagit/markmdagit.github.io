<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui; background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; padding: 1rem; }
        .app { max-width: 800px; margin: 0 auto; background: rgba(255,255,255,0.95); border-radius: 1rem; overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 2rem; text-align: center; }
        .content { padding: 2rem; }
        .form { background: #f8f9fa; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem; }
        .field { margin-bottom: 1rem; }
        .field label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333; }
        input, textarea, select { width: 100%; padding: 0.75rem; border: 2px solid #e9ecef; border-radius: 0.5rem; font-family: inherit; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 2rem; cursor: pointer; font-weight: 600; margin-right: 0.5rem; }
        .btn:hover { transform: translateY(-1px); }
        .btn-secondary { background: #6c757d; }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.8rem; }
        .btn-edit { background: #28a745; }
        .btn-delete { background: #dc3545; }
        .controls { display: grid; grid-template-columns: 1fr auto; gap: 1rem; margin-bottom: 1.5rem; }
        .entry { background: white; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid #667eea; }
        .entry-header { display: flex; justify-content: space-between; margin-bottom: 0.75rem; gap: 1rem; }
        .entry-title { font-weight: 600; margin-bottom: 0.25rem; }
        .entry-meta { color: #666; font-size: 0.8rem; }
        .entry-type { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; }
        .entry-content { margin-bottom: 1rem; line-height: 1.5; }
        .empty { text-align: center; padding: 3rem; color: #666; }
        .hidden { display: none !important; }
        .error { color: #dc3545; font-size: 0.8rem; }
        @media (max-width: 640px) { .app { margin: 0.5rem; } .controls { grid-template-columns: 1fr; } .entry-header { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <h1>üìù Journal</h1>
            <p>Your thoughts, secured</p>
        </header>
        <main class="content">
            <section class="form">
                <h2>New Entry</h2>
                <div id="msg"></div>
                <form id="form">
                    <div class="field">
                        <label>Title</label>
                        <input id="title" maxlength="100" required>
                        <div class="error" id="titleErr"></div>
                    </div>
                    <div class="field">
                        <label>Type</label>
                        <select id="type" required>
                            <option value="">Select...</option>
                            <option value="journal">üìî Journal</option>
                            <option value="note">üìù Note</option>
                            <option value="idea">üí° Idea</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>Content</label>
                        <textarea id="content" maxlength="1000" required></textarea>
                        <div class="error" id="contentErr"></div>
                    </div>
                    <button type="submit" class="btn" id="submit">Add</button>
                    <button type="button" class="btn btn-secondary hidden" id="cancel">Cancel</button>
                </form>
            </section>
            <section>
                <div class="controls">
                    <input type="search" id="search" placeholder="üîç Search...">
                    <select id="filter">
                        <option value="">All</option>
                        <option value="journal">Journal</option>
                        <option value="note">Note</option>
                        <option value="idea">Idea</option>
                    </select>
                </div>
                <div id="entries">
                    <div class="empty"><h3>No entries</h3><p>Create your first entry!</p></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        'use strict';
        
        class Journal {
            constructor() {
                this.entries = [];
                this.editing = null;
                this.init();
            }
            
            init() {
                const form = document.getElementById('form');
                const search = document.getElementById('search');
                const filter = document.getElementById('filter');
                
                form.onsubmit = e => this.save(e);
                search.oninput = () => this.render();
                filter.onchange = () => this.render();
                document.getElementById('cancel').onclick = () => this.reset();
                
                this.render();
            }
            
            validate() {
                const title = document.getElementById('title').value.trim();
                const content = document.getElementById('content').value.trim();
                const type = document.getElementById('type').value;
                
                let valid = true;
                
                if (!title || title.length > 100) {
                    document.getElementById('titleErr').textContent = 'Invalid title';
                    valid = false;
                } else {
                    document.getElementById('titleErr').textContent = '';
                }
                
                if (!content || content.length > 1000) {
                    document.getElementById('contentErr').textContent = 'Invalid content';
                    valid = false;
                } else {
                    document.getElementById('contentErr').textContent = '';
                }
                
                return valid && type;
            }
            
            sanitize(str) {
                return str.replace(/[<>&"']/g, m => ({'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;',"'":'&#x27;'})[m]);
            }
            
            save(e) {
                e.preventDefault();
                
                if (!this.validate()) return;
                
                const entry = {
                    id: this.editing || Date.now(),
                    title: this.sanitize(document.getElementById('title').value.trim()),
                    type: document.getElementById('type').value,
                    content: this.sanitize(document.getElementById('content').value.trim()),
                    created: this.editing ? this.entries.find(e => e.id === this.editing)?.created || new Date().toISOString() : new Date().toISOString(),
                    updated: new Date().toISOString()
                };
                
                if (this.editing) {
                    const i = this.entries.findIndex(e => e.id === this.editing);
                    this.entries[i] = entry;
                } else {
                    this.entries.unshift(entry);
                }
                
                this.reset();
                this.render();
                this.msg('Saved!');
            }
            
            edit(id) {
                const entry = this.entries.find(e => e.id === id);
                if (!entry) return;
                
                document.getElementById('title').value = entry.title;
                document.getElementById('type').value = entry.type;
                document.getElementById('content').value = entry.content;
                
                this.editing = id;
                document.getElementById('submit').textContent = 'Update';
                document.getElementById('cancel').classList.remove('hidden');
            }
            
            delete(id) {
                if (confirm('Delete entry?')) {
                    this.entries = this.entries.filter(e => e.id !== id);
                    this.render();
                    this.msg('Deleted!');
                }
            }
            
            reset() {
                this.editing = null;
                document.getElementById('form').reset();
                document.getElementById('submit').textContent = 'Add';
                document.getElementById('cancel').classList.add('hidden');
                document.getElementById('titleErr').textContent = '';
                document.getElementById('contentErr').textContent = '';
            }
            
            msg(text) {
                const div = document.getElementById('msg');
                div.innerHTML = `<div style="background:#d4edda;color:#155724;padding:0.5rem;border-radius:0.5rem;margin-bottom:1rem;">${text}</div>`;
                setTimeout(() => div.innerHTML = '', 2000);
            }
            
            render() {
                const search = document.getElementById('search').value.toLowerCase();
                const filter = document.getElementById('filter').value;
                
                let filtered = this.entries.filter(e => {
                    const matchSearch = !search || e.title.toLowerCase().includes(search) || e.content.toLowerCase().includes(search);
                    const matchFilter = !filter || e.type === filter;
                    return matchSearch && matchFilter;
                });
                
                const container = document.getElementById('entries');
                
                if (!filtered.length) {
                    container.innerHTML = '<div class="empty"><h3>No entries</h3><p>Try different search terms</p></div>';
                    return;
                }
                
                container.innerHTML = filtered.map(e => `
                    <div class="entry">
                        <div class="entry-header">
                            <div>
                                <div class="entry-title">${e.title}</div>
                                <div class="entry-meta">${new Date(e.created).toLocaleDateString()} ${e.updated !== e.created ? '(edited)' : ''}</div>
                            </div>
                            <div class="entry-type">${this.icon(e.type)} ${e.type}</div>
                        </div>
                        <div class="entry-content">${e.content.replace(/\n/g, '<br>')}</div>
                        <div>
                            <button class="btn btn-edit btn-small" onclick="app.edit(${e.id})">Edit</button>
                            <button class="btn btn-delete btn-small" onclick="app.delete(${e.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
            
            icon(type) {
                return {journal: 'üìî', note: 'üìù', idea: 'üí°'}[type] || 'üìù';
            }
        }
        
        const app = new Journal();
    </script>
</body>
</html>